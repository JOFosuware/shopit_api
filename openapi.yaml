openapi: 3.0.0
info:
  title: "Shopit API"
  description: "API for the Shopit e-commerce platform."
  version: "1.0.0"

servers:
  - url: http://localhost:8080/api/v1
    description: Development server

paths:
  # Authentication
  /auth/register:
    post:
      summary: Register a new user
      tags: ["Authentication"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewUser'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Invalid input

  /auth/login:
    post:
      summary: Login a user
      tags: ["Authentication"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginCredentials'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthToken'
        '401':
          description: Unauthorized

  /auth/logout/{token}:
    get:
      summary: Logout user
      tags: ["Authentication"]
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Logout successful
        '400':
          description: Invalid token

  /auth/me:
    get:
      summary: Get current user profile
      tags: ["Authentication"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
    put:
      summary: Update current user profile
      tags: ["Authentication"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUser'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Invalid input
        '401':
          description: Unauthorized

  /auth/password/forgot:
    post:
      summary: Forgot password
      tags: ["Authentication"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPassword'
      responses:
        '200':
          description: Password reset email sent
        '400':
          description: Invalid input

  /auth/password/reset/{token}:
    put:
      summary: Reset password
      tags: ["Authentication"]
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPassword'
      responses:
        '200':
          description: Password reset successful
        '400':
          description: Invalid token or input

  /auth/password/update:
    put:
      summary: Update password
      tags: ["Authentication"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePassword'
      responses:
        '200':
          description: Password updated successfully
        '400':
          description: Invalid input
        '401':
          description: Unauthorized

  /auth/admin/users:
    get:
      summary: Get all users (admin)
      tags: ["Authentication", "Admin"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: A list of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /auth/admin/user/{id}:
    get:
      summary: Get user details by ID (admin)
      tags: ["Authentication", "Admin"]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: User not found
    put:
      summary: Update user by ID (admin)
      tags: ["Authentication", "Admin"]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUser'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Invalid input
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: User not found
    delete:
      summary: Delete user by ID (admin)
      tags: ["Authentication", "Admin"]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: User deleted successfully
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: User not found

  # Products
  /product/products:
    get:
      summary: Get all products
      tags: ["Products"]
      responses:
        '200':
          description: A list of products
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'

  /product/new:
    post:
      summary: Create a new product (admin)
      tags: ["Products", "Admin"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewProduct'
      responses:
        '201':
          description: Product created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /product/product/{id}:
    get:
      summary: Get a product by ID
      tags: ["Products"]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: A single product
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: Product not found

  /product/admin/products:
    get:
      summary: Get all products (admin)
      tags: ["Products", "Admin"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: A list of products
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /product/admin/product/{id}:
    put:
      summary: Update a product (admin)
      tags: ["Products", "Admin"]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProduct'
      responses:
        '200':
          description: Product updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Product not found
    delete:
      summary: Delete a product (admin)
      tags: ["Products", "Admin"]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Product deleted successfully
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Product not found

  /product/review:
    put:
      summary: Create or update a product review
      tags: ["Products"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewReview'
      responses:
        '200':
          description: Review created/updated successfully
        '400':
          description: Invalid input
        '401':
          description: Unauthorized

  /product/reviews:
    get:
      summary: Get all reviews for a product
      tags: ["Products"]
      parameters:
        - name: product_id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: A list of reviews
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Review'
        '404':
          description: Product not found
    delete:
      summary: Delete a product review
      tags: ["Products"]
      security:
        - bearerAuth: []
      parameters:
        - name: product_id
          in: query
          required: true
          schema:
            type: integer
        - name: review_id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Review deleted successfully
        '401':
          description: Unauthorized
        '404':
          description: Review not found

  # Orders
  /orders/new:
    post:
      summary: Create a new order
      tags: ["Orders"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewOrder'
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '401':
          description: Unauthorized

  /orders/me:
    get:
      summary: Get current user's orders
      tags: ["Orders"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: A list of the current user's orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
        '401':
          description: Unauthorized

  /orders/{id}:
    get:
      summary: Get an order by ID
      tags: ["Orders"]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: A single order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '401':
          description: Unauthorized
        '404':
          description: Order not found

  /orders/admin/orders:
    get:
      summary: Get all orders (admin)
      tags: ["Orders", "Admin"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: A list of all orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /orders/admin/order/{id}:
    put:
      summary: Update an order's status (admin)
      tags: ["Orders", "Admin"]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrder'
      responses:
        '200':
          description: Order updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Order not found
    delete:
      summary: Delete an order (admin)
      tags: ["Orders", "Admin"]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Order deleted successfully
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Order not found

  # Payment
  /payment/process:
    post:
      summary: Process a payment
      tags: ["Payment"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
      responses:
        '200':
          description: Payment successful
        '401':
          description: Unauthorized

  /payment/stripeapi:
    get:
      summary: Get Stripe API key
      tags: ["Payment"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Stripe API key
          content:
            application/json:
              schema:
                type: object
                properties:
                  stripeApiKey:
                    type: string
        '401':
          description: Unauthorized

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Auth Schemas
    NewUser:
      type: object
      properties:
        first_name: { type: string, example: "John" }
        last_name: { type: string, example: "Doe" }
        email: { type: string, format: email, example: "john.doe@example.com" }
        password: { type: string, format: password, example: "strongpassword123" }
    UpdateUser:
      type: object
      properties:
        first_name: { type: string, example: "John" }
        last_name: { type: string, example: "Doe" }
        email: { type: string, format: email, example: "john.doe@example.com" }
    LoginCredentials:
      type: object
      properties:
        email: { type: string, format: email, example: "john.doe@example.com" }
        password: { type: string, format: password, example: "strongpassword123" }
    ForgotPassword:
      type: object
      properties:
        email: { type: string, format: email, example: "john.doe@example.com" }
    ResetPassword:
      type: object
      properties:
        password: { type: string, format: password, example: "newstrongpassword123" }
    UpdatePassword:
      type: object
      properties:
        old_password: { type: string, format: password, example: "strongpassword123" }
        new_password: { type: string, format: password, example: "newstrongpassword123" }
    AuthToken:
      type: object
      properties:
        token: { type: string, example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." }
    User:
      type: object
      properties:
        id: { type: integer, example: 1 }
        first_name: { type: string, example: "John" }
        last_name: { type: string, example: "Doe" }
        email: { type: string, format: email, example: "john.doe@example.com" }
        is_admin: { type: boolean, example: false }

    # Product Schemas
    Product:
      type: object
      properties:
        id: { type: integer, example: 1 }
        name: { type: string, example: "Laptop" }
        description: { type: string, example: "A powerful laptop" }
        price: { type: number, format: float, example: 1299.99 }
        stock: { type: integer, example: 50 }
        reviews:
          type: array
          items:
            $ref: '#/components/schemas/Review'
    NewProduct:
      type: object
      properties:
        name: { type: string, example: "New Gadget" }
        description: { type: string, example: "The latest and greatest gadget" }
        price: { type: number, format: float, example: 199.99 }
        stock: { type: integer, example: 100 }
    UpdateProduct:
      type: object
      properties:
        name: { type: string, example: "Updated Gadget" }
        description: { type: string, example: "An even better description" }
        price: { type: number, format: float, example: 179.99 }
        stock: { type: integer, example: 150 }
    Review:
      type: object
      properties:
        id: { type: integer, example: 1 }
        user_id: { type: integer, example: 1 }
        name: { type: string, example: "John Doe" }
        rating: { type: integer, example: 5 }
        comment: { type: string, example: "Great product!" }
    NewReview:
      type: object
      properties:
        product_id: { type: integer, example: 1 }
        rating: { type: integer, example: 5 }
        comment: { type: string, example: "This is awesome!" }

    # Order Schemas
    Order:
      type: object
      properties:
        id: { type: integer, example: 101 }
        user_id: { type: integer, example: 1 }
        total: { type: number, format: float, example: 399.98 }
        status: { type: string, example: "pending" }
        paid: { type: boolean, example: false }
        payment_method: { type: string, example: "stripe" }
        order_items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
    OrderItem:
      type: object
      properties:
        product_id: { type: integer, example: 2 }
        quantity: { type: integer, example: 2 }
    NewOrder:
      type: object
      properties:
        payment_method: { type: string, example: "stripe" }
        order_items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
    UpdateOrder:
      type: object
      properties:
        status: { type: string, example: "shipped" }

    # Payment Schemas
    PaymentRequest:
      type: object
      properties:
        order_id: { type: integer, example: 101 }
        amount: { type: number, format: float, example: 399.98 }
